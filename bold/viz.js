{"_id":"_design/viz","_rev":"3-2709951d5358586a9187d5e192544ff7","language":"javascript","views":{"lineage_bin":{"map":"// Build lineage paths and create a key [[path],bin] so we can count BINs\n// per clade (instead of just barcodes)\nfunction(doc) {\n  var path = [];\n\n  if (doc.phylum_reg || doc.phylum_name) {\n    \n    //---------------------------\n    var phylum = 'phylum';\n   \n    // Download\n    if (doc.phylum_reg) {\n      phylum = doc.phylum_reg;\n    }\n    \n    // API\n    if (doc.phylum_name) {\n      phylum = doc.phylum_name;\n    }\n    path.push(phylum);\n    \n    //---------------------------\n    var class = 'class';\n   \n    // Download\n    if (doc.class_reg) {\n      class = doc.class_reg;\n    }\n    \n    // API\n    if (doc.class_name) {\n      class = doc.class_name;\n    }\n    path.push(class);\n \n    //---------------------------\n    var order = 'order';\n   \n    // Download\n    if (doc.order_reg) {\n      order = doc.order_reg;\n    }\n    \n    // API\n    if (doc.order_name) {\n      order = doc.order_name;\n    }\n    path.push(order);\n \n    //---------------------------\n    var species = 'species';\n   \n    // Download\n    if (doc.species_reg) {\n      species = doc.species_reg;\n    }\n    \n    // API\n    if (doc.species_name) {\n      species = doc.species_name;\n    }\n    path.push(species);\n\n    //---------------------------\n\n    var bin = 'bin';\n  \n    // Download\n    if (doc.bin_guid) {\n      bin = doc.bin_guid;\n    }\n    // API\n    if (doc.bin_uri) {\n     bin = doc.bin_uri;\n    }\n  \n    if (bin != 'bin') {\n      path.push(bin);\n      emit(path,1);\n    }\n  }\n}","reduce":"_sum"}}}
